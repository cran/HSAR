<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)}
-->

<h1>Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)</h1>

<p>A detailed synthetic example will illustrate the use of the hsar() function, including the generation of attribute data,spatial data and the extraction of the spatial weights matrices and the random effect design matrix. </p>

<h3>Libraries</h3>

<p>In order to run the example, sp, maptools, rdgal and rgeos libraries will be loaded.</p>

<pre><code class="r">library(maptools)
library(rgdal)
library(rgeos)
</code></pre>

<h3>Creating synthetic data</h3>

<p>Initialy we set up a grid data representing higher-level units, say neighbourhoods</p>

<pre><code class="r">grid_high &lt;- GridTopology(cellcentre.offset=c(1,1),cellsize=c(1,1),cells.dim=c(10,10))
grid_sp &lt;- SpatialGrid(grid_high)
</code></pre>

<p>then we create an attribute, say population, for the grid cells</p>

<pre><code class="r">population &lt;- as.numeric(scale(rpois(100,10)))
</code></pre>

<p>and create a SpatialGridDataFrame</p>

<pre><code class="r">grid_data &lt;- SpatialGridDataFrame(grid_sp,data.frame(population))
</code></pre>

<p>Now check the names of each grid cell and plot the four cells from the left-top corner. Also, let&#39;s create lower-level units, says 2000 individuals</p>

<pre><code class="r">plot(grid_data)
text(coordinates(grid_data),row.names(grid_data),col=&quot;red&quot;,cex=0.7)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-5"/></p>

<pre><code class="r">plot(grid_data[1:2,1:2,&quot;population&quot;],add=TRUE,col=&quot;blue&quot;,lwd=3)

individual_points &lt;- spsample(grid_data,2000,&quot;random&quot;)
row.names(individual_points) &lt;- as.character(1:2000)
points(individual_points,pch=16,cex=0.7)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-5"/></p>

<p>and create some attributes for individuals</p>

<pre><code class="r">att.data &lt;- data.frame(happiness=as.numeric(scale(runif(2000,1,10))),
                       income=as.numeric(scale(runif(2000,1,10))),
                       age=as.numeric(scale(round(runif(2000,20,50)))))
row.names(att.data) &lt;- as.character(1:2000)
individual_data &lt;- SpatialPointsDataFrame(individual_points,att.data)
</code></pre>

<h3>Create matrices used in the hsar function</h3>

<p>Now we extract the random effect design matrix and two spatial weights matrices to use the hsar() function.</p>

<p>So we start by finding out the neighbouhood where each individual is located based on the spatial locations </p>

<pre><code class="r">link.index &lt;- over(individual_points,grid_sp)
</code></pre>

<p>and by extracting the population attribute of the neighbourhood where an individual is located</p>

<pre><code class="r">link.data &lt;- over(individual_data,grid_data)
link.data &lt;- data.frame(neighbourhood_index=link.index,link.data)
individual_data@data &lt;- data.frame(individual_data@data,link.data)
</code></pre>

<p>Next we order the data so that the neighbourhood index is ordered ascendingly</p>

<pre><code class="r">model.data.sp &lt;- individual_data[order(individual_data$neighbourhood_index),]
</code></pre>

<p>and we can have a look at the first 10 observations</p>

<pre><code class="r">head(model.data.sp@data,10)
</code></pre>

<pre><code>##        happiness     income        age neighbourhood_index population
## 344   0.92403639  0.9552658  0.3437325                   1 -0.8806948
## 508  -1.18371161  0.6745939 -1.2842291                   1 -0.8806948
## 585   1.34942887  0.6332669  1.1577132                   1 -0.8806948
## 687   0.02024352  0.5314872 -0.3539654                   1 -0.8806948
## 789   1.11028380 -1.1066955 -1.6330780                   1 -0.8806948
## 839  -1.50313934 -0.3521266  1.5065621                   1 -0.8806948
## 847  -1.18974128 -0.6344352  1.0414303                   1 -0.8806948
## 853   0.55578797 -1.2006361  1.7391281                   1 -0.8806948
## 982   0.30767385 -1.0453654  0.4600154                   1 -0.8806948
## 1315 -1.00330033  1.7101341 -0.9353802                   1 -0.8806948
</code></pre>

<p>Let&#39;s define the random effect matrix which captures the number of individuals within each neighbourhood</p>

<pre><code class="r">MM &lt;- as.data.frame(table(model.data.sp$neighbourhood_index))
</code></pre>

<p>Find the total number of neighbourhood  (100 in our case)</p>

<pre><code class="r">Utotal &lt;- dim(MM)[1]
Unum &lt;- MM[,2]
Uid &lt;- rep(c(1:Utotal),Unum)
</code></pre>

<p>Define the random effect matrix (Delta) with a dimension of 2000x100</p>

<pre><code class="r">library(spdep)
n &lt;- nrow(model.data.sp)
Delta &lt;- matrix(0,nrow=n,ncol=Utotal)
for(i in 1:Utotal) {
  Delta[Uid==i,i] &lt;- 1
}
rm(i)

Delta &lt;- as(Delta,&quot;dgCMatrix&quot;)
</code></pre>

<p>Evaluate the neighbourhood-level (higher-level) spatial weights matrix based on sharing a common border (Rook&#39;s rule). Here we should note that if neighbourhoods are represented by spatial polygons, the extraction of the neighbour list and weights matrix is obtained through the poly2nb() and nb2listw() (or nb2mat()) functions in the R spdep package.</p>

<pre><code class="r">temp.coords &lt;- coordinates(grid_sp)
distance &lt;- array(0,c(Utotal,Utotal))
M &lt;- array(0,c(Utotal,Utotal))
  for(i in 1:Utotal) {
    for(j in 1:Utotal){
      temp &lt;- (temp.coords[i,1] - temp.coords[j,1])^2 + (temp.coords[i,2] - temp.coords[j,2])^2 
      distance[i,j] &lt;- sqrt(temp)
      if(temp == 1) M[i,j] &lt;- 1
    }
  }
</code></pre>

<p>Then row-normalize M</p>

<pre><code class="r">M &lt;- M / rowSums(M)
M &lt;- as(M,&quot;dgCMatrix&quot;)
</code></pre>

<p>Then create the individual-level spatial weights matrix W. We simply assume each individual is interacting with other individuals located within a radius of 1.5 units. The intensity of interaction is measured by how far individuals are separated with a Gaussian distance decay kernel</p>

<pre><code class="r">library(RColorBrewer)
library(classInt)
</code></pre>

<p>So create the neighbour list</p>

<pre><code class="r">nb.15 &lt;- dnearneigh(model.data.sp,0,1.5)
</code></pre>

<p>and the weights matrix W</p>

<pre><code class="r">dist.15 &lt;- nbdists(nb.15,model.data.sp)
dist.15 &lt;- lapply(dist.15,function(x) exp(-0.5 * (x / 1.5)^2))
mat.15 &lt;- nb2mat(nb.15,glist=dist.15,style=&quot;W&quot;)
W &lt;- as(mat.15,&quot;dgCMatrix&quot;)
</code></pre>

<h3>Run the models</h3>

<p>Now let&#39;s simulate our outcome variable i.e. health of each individual using arbitary values of model parameters.</p>

<pre><code class="r">rho &lt;- 0.2
lambda &lt;- 0.7
sigma2e &lt;- 0.8
sigma2u &lt;- 0.4
betas &lt;- c(3,2,3,4,5)
</code></pre>

<p>In order to run th emodels we simulate neighbourhood-level random effect</p>

<pre><code class="r">thetas &lt;- as.numeric(solve(diag(Utotal) - lambda*M) %*% rnorm(Utotal,mean=0,sd=sqrt(sigma2u)))
grid_data$thetas_true &lt;- thetas
image(grid_data,&quot;thetas_true&quot;)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-20"/></p>

<p>and simulate an individual-level outcome variable &mdash; health</p>

<pre><code class="r">X.mat &lt;- as.matrix(model.data.sp@data[,c(&quot;happiness&quot;,&quot;income&quot;,&quot;age&quot;,&quot;population&quot;)])
X.mat &lt;- cbind(rep(1,n),X.mat)
health &lt;- as.numeric(solve(diag(n) - rho*W) %*% (X.mat %*% betas + Delta %*% thetas + rnorm(n,0,sqrt(sigma2e))))
model.data.sp$health &lt;- health
</code></pre>

<p>So we wun the hsar() function</p>

<pre><code class="r">library(HSAR)
res.formula &lt;- health ~ happiness + income + age + population
res &lt;- hsar(res.formula,data=model.data.sp@data,W=W,M=M,Delta=Delta,burnin=100, Nsim=200)
summary(res)
</code></pre>

<pre><code>## 
## Call:
## hsar(formula = res.formula, data = model.data.sp@data, W = W, 
##     M = M, Delta = Delta, burnin = 100, Nsim = 200)
## Type:  hsar  
## 
## Coefficients:
##   (Intercept) happiness   income      age population
## 1    2.799396  1.949272 2.999727 3.967149   5.052837
## 
##  Spatial Coefficients:
##          rho  lambda
## [1,] 0.19099 0.76155
## 
##  Diagnostics 
## Deviance information criterion (DIC): 5357.995 
## Effective number of parameters (pd): 130.1882 
## Log likelihood: -2548.809 
## Pseudo R squared: 0.985815 
## 
##  Impacts:
##               direct  indirect    total
## (Intercept) 2.800391 0.6597150 3.460106
## happiness   1.949964 0.4593718 2.409336
## income      3.000793 0.7069256 3.707718
## age         3.968559 0.9349115 4.903470
## population  5.054632 1.1907683 6.245400
</code></pre>

<p>and visualise the estimated neighbourhood effect</p>

<pre><code class="r">grid_data$theta.est &lt;- thetas.est &lt;- as.numeric(res$Mus)
image(grid_data,&quot;theta.est&quot;,breaks=as.numeric(quantile(thetas.est)),col=brewer.pal(4,&quot;Reds&quot;))
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-23"/></p>

<p>Furher let&#39;s run another two simpler models
Firstly,  a model assuming rho = 0, that is, no interaction effects at the individual level</p>

<pre><code class="r">res_1 &lt;- hsar(res.formula,data=model.data.sp@data,W=NULL,M=M,Delta=Delta,burnin=100, Nsim=200)
summary(res_1)
</code></pre>

<p>and secondly, a model assuming lambda = 0, that is, no interaction effects at the neighbourhood level</p>

<pre><code class="r">res_2 &lt;- hsar(res.formula,data=model.data.sp@data,W=W,M=NULL,Delta=Delta,burnin=100, Nsim=200)
summary(res_2)
</code></pre>

</body>

</html>
