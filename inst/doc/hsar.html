<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)}
-->

<h1>Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)</h1>

<p>A detailed synthetic example will illustrate the use of the hsar() function, including the generation of attribute data,spatial data and the extraction of the spatial weights matrices and the random effect design matrix. </p>

<h3>Libraries</h3>

<p>In order to run the example, sp, maptools, rdgal and rgeos libraries will be loaded.</p>

<pre><code class="r">library(maptools)
library(rgdal)
library(rgeos)
</code></pre>

<h3>Creating synthetic data</h3>

<p>Initialy we set up a grid data representing higher-level units, say neighbourhoods</p>

<pre><code class="r">grid_high &lt;- GridTopology(cellcentre.offset=c(1,1),cellsize=c(1,1),cells.dim=c(10,10))
grid_sp &lt;- SpatialGrid(grid_high)
</code></pre>

<p>then we create an attribute, say population, for the grid cells</p>

<pre><code class="r">population &lt;- as.numeric(scale(rpois(100,10)))
</code></pre>

<p>and create a SpatialGridDataFrame</p>

<pre><code class="r">grid_data &lt;- SpatialGridDataFrame(grid_sp,data.frame(population))
</code></pre>

<p>Now check the names of each grid cell and plot the four cells from the left-top corner. Also, let&#39;s create lower-level units, says 2000 individuals</p>

<pre><code class="r">par(mar=c(0,0,0,0))
plot(grid_data)
text(coordinates(grid_data),row.names(grid_data),col=&quot;red&quot;,cex=0.7)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-5"/></p>

<pre><code class="r">plot(grid_data[1:2,1:2,&quot;population&quot;],add=TRUE,col=&quot;blue&quot;,lwd=3)

individual_points &lt;- spsample(grid_data,2000,&quot;random&quot;)
row.names(individual_points) &lt;- as.character(1:2000)
points(individual_points,pch=16,cex=0.7)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-5"/></p>

<p>and create some attributes for individuals</p>

<pre><code class="r">att.data &lt;- data.frame(happiness=as.numeric(scale(runif(2000,1,10))),
                       income=as.numeric(scale(runif(2000,1,10))),
                       age=as.numeric(scale(round(runif(2000,20,50)))))
row.names(att.data) &lt;- as.character(1:2000)
individual_data &lt;- SpatialPointsDataFrame(individual_points,att.data)
</code></pre>

<h3>Create matrices used in the hsar function</h3>

<p>Now we extract the random effect design matrix and two spatial weights matrices to use the hsar() function.</p>

<p>So we start by finding out the neighbouhood where each individual is located based on the spatial locations </p>

<pre><code class="r">link.index &lt;- over(individual_points,grid_sp)
</code></pre>

<p>and by extracting the population attribute of the neighbourhood where an individual is located</p>

<pre><code class="r">link.data &lt;- over(individual_data,grid_data)
link.data &lt;- data.frame(neighbourhood_index=link.index,link.data)
individual_data@data &lt;- data.frame(individual_data@data,link.data)
</code></pre>

<p>Next we order the data so that the neighbourhood index is ordered ascendingly</p>

<pre><code class="r">model.data.sp &lt;- individual_data[order(individual_data$neighbourhood_index),]
</code></pre>

<p>and we can have a look at the first 10 observations</p>

<pre><code class="r">head(model.data.sp@data,10)
</code></pre>

<pre><code>##      happiness      income        age neighbourhood_index population
## 129 -1.4163130 -0.28492961  0.5892690                   1 -0.8012623
## 183 -1.0102557 -0.83644168 -1.3873635                   1 -0.8012623
## 242  0.2287112  1.21947162  0.1241790                   1 -0.8012623
## 322 -0.6852214  1.31654263 -1.0385460                   1 -0.8012623
## 341  0.1065264  0.01257892  1.2869040                   1 -0.8012623
## 444 -0.2984263  1.51707649 -1.6199084                   1 -0.8012623
## 460  0.2066430  0.29458222 -1.3873635                   1 -0.8012623
## 551  0.8862559 -0.07769619 -1.6199084                   1 -0.8012623
## 911 -1.4305800  1.66263865 -1.1548185                   1 -0.8012623
## 920  0.6660793  0.34383228 -0.4571835                   1 -0.8012623
</code></pre>

<p>Let&#39;s define the random effect matrix which captures the number of individuals within each neighbourhood</p>

<pre><code class="r">MM &lt;- as.data.frame(table(model.data.sp$neighbourhood_index))
</code></pre>

<p>Find the total number of neighbourhood  (100 in our case)</p>

<pre><code class="r">Utotal &lt;- dim(MM)[1]
Unum &lt;- MM[,2]
Uid &lt;- rep(c(1:Utotal),Unum)
</code></pre>

<p>Define the random effect matrix (Delta) with a dimension of 2000x100</p>

<pre><code class="r">library(spdep)
n &lt;- nrow(model.data.sp)
Delta &lt;- matrix(0,nrow=n,ncol=Utotal)
for(i in 1:Utotal) {
  Delta[Uid==i,i] &lt;- 1
}
rm(i)

Delta &lt;- as(Delta,&quot;dgCMatrix&quot;)
</code></pre>

<p>Evaluate the neighbourhood-level (higher-level) spatial weights matrix based on sharing a common border (Rook&#39;s rule). Here we should note that if neighbourhoods are represented by spatial polygons, the extraction of the neighbour list and weights matrix is obtained through the poly2nb() and nb2listw() (or nb2mat()) functions in the R spdep package.</p>

<pre><code class="r">temp.coords &lt;- coordinates(grid_sp)
distance &lt;- array(0,c(Utotal,Utotal))
M &lt;- array(0,c(Utotal,Utotal))
  for(i in 1:Utotal) {
    for(j in 1:Utotal){
      temp &lt;- (temp.coords[i,1] - temp.coords[j,1])^2 + (temp.coords[i,2] - temp.coords[j,2])^2 
      distance[i,j] &lt;- sqrt(temp)
      if(temp == 1) M[i,j] &lt;- 1
    }
  }
</code></pre>

<p>Then row-normalize M</p>

<pre><code class="r">M &lt;- M / rowSums(M)
M &lt;- as(M,&quot;dgCMatrix&quot;)
</code></pre>

<p>Then create the individual-level spatial weights matrix W. We simply assume each individual is interacting with other individuals located within a radius of 1.5 units. The intensity of interaction is measured by how far individuals are separated with a Gaussian distance decay kernel</p>

<pre><code class="r">library(RColorBrewer)
library(classInt)
</code></pre>

<p>So create the neighbour list</p>

<pre><code class="r">nb.15 &lt;- dnearneigh(model.data.sp,0,1.5)
</code></pre>

<p>and the weights matrix W</p>

<pre><code class="r">dist.15 &lt;- nbdists(nb.15,model.data.sp)
dist.15 &lt;- lapply(dist.15,function(x) exp(-0.5 * (x / 1.5)^2))
mat.15 &lt;- nb2mat(nb.15,glist=dist.15,style=&quot;W&quot;)
W &lt;- as(mat.15,&quot;dgCMatrix&quot;)
</code></pre>

<h3>Run the models</h3>

<p>Now let&#39;s simulate our outcome variable i.e. health of each individual using arbitary values of model parameters.</p>

<pre><code class="r">rho &lt;- 0.2
lambda &lt;- 0.7
sigma2e &lt;- 0.8
sigma2u &lt;- 0.4
betas &lt;- c(3,2,3,4,5)
</code></pre>

<p>In order to run th emodels we simulate neighbourhood-level random effect</p>

<pre><code class="r">thetas &lt;- as.numeric(solve(diag(Utotal) - lambda*M) %*% rnorm(Utotal,mean=0,sd=sqrt(sigma2u)))
grid_data$thetas_true &lt;- thetas
image(grid_data,&quot;thetas_true&quot;)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-20"/></p>

<p>and simulate an individual-level outcome variable &mdash; health</p>

<pre><code class="r">X.mat &lt;- as.matrix(model.data.sp@data[,c(&quot;happiness&quot;,&quot;income&quot;,&quot;age&quot;,&quot;population&quot;)])
X.mat &lt;- cbind(rep(1,n),X.mat)
health &lt;- as.numeric(solve(diag(n) - rho*W) %*% (X.mat %*% betas + Delta %*% thetas + rnorm(n,0,sqrt(sigma2e))))
model.data.sp$health &lt;- health
</code></pre>

<p>So we wun the hsar() function</p>

<pre><code class="r">library(HSAR)
res.formula &lt;- health ~ happiness + income + age + population
res &lt;- hsar(res.formula,data=model.data.sp@data,W=W,M=M,Delta=Delta,burnin=100, Nsim=200)
summary(res)
</code></pre>

<pre><code>## 
## Call:
## hsar(formula = res.formula, data = model.data.sp@data, W = W, 
##     M = M, Delta = Delta, burnin = 100, Nsim = 200)
## Type:  hsar  
## 
## Coefficients:
##   (Intercept) happiness   income     age population
## 1    3.502698  2.004987 3.007799 3.98956   5.051308
## 
##  Spatial Coefficients:
##          rho  lambda
## [1,] 0.12728 0.77017
## 
##  Diagnostics 
## Deviance information criterion (DIC): 5473.268 
## Effective number of parameters (pd): 136.7802 
## Log likelihood: -2599.854 
## Pseudo R squared: 0.9846117 
## 
##  Impacts:
##               direct  indirect    total
## (Intercept) 3.503230 0.5102951 4.013525
## happiness   2.005292 0.2920992 2.297391
## income      3.008255 0.4381950 3.446450
## age         3.990165 0.5812242 4.571390
## population  5.052074 0.7359063 5.787981
</code></pre>

<p>and visualise the estimated neighbourhood effect</p>

<pre><code class="r">grid_data$theta.est &lt;- thetas.est &lt;- as.numeric(res$Mus)
image(grid_data,&quot;theta.est&quot;,breaks=as.numeric(quantile(thetas.est)),col=brewer.pal(4,&quot;Reds&quot;))
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-23"/></p>

<p>Furher let&#39;s run another two simpler models
Firstly,  a model assuming rho = 0, that is, no interaction effects at the individual level</p>

<pre><code class="r">res_1 &lt;- hsar(res.formula,data=model.data.sp@data,W=NULL,M=M,Delta=Delta,burnin=100, Nsim=200)
summary(res_1)
</code></pre>

<p>and secondly, a model assuming lambda = 0, that is, no interaction effects at the neighbourhood level</p>

<pre><code class="r">res_2 &lt;- hsar(res.formula,data=model.data.sp@data,W=W,M=NULL,Delta=Delta,burnin=100, Nsim=200)
summary(res_2)
</code></pre>

</body>

</html>
